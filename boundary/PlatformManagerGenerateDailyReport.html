<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Daily Report</title>
  <style>
    body { font-family: Arial; padding: 30px; }
    pre { border: 1px solid #000; padding: 10px; background: #f9f9f9; }
  </style>
</head>
<body>
  <h3>Generate Daily Volunteer Activity Report</h3>
  <button id="loadReport">Generate</button>
  <input type="date" id="reportDate" />
  <pre id="report"></pre>

  <script>
    document.getElementById('loadReport').addEventListener('click', async () => {
      const token = localStorage.getItem("sessionToken") || '';
      const date = document.getElementById("reportDate").value;
      const resultsDiv = document.getElementById("report");
      resultsDiv.innerHTML = '';

      if (!token) {
        resultsDiv.innerHTML = `<p>Session token missing. Please log in.</p>`;
        return;
      }

      const query = date ? `?date=${date}` : '';

      try {
        const res = await fetch(`http://localhost:3000/api/reports/daily${query}`, {
          method: 'GET',
          headers: {
            Authorization: `Bearer ${token}`,
            'Content-Type': 'application/json'
          }
        });

        const data = await res.json();
        if (!data.success || !data.report) {
          throw new Error(data.message || "Unexpected response");
        }

        const { date: reportDate, totalRequestsCreated, totalRequestsCompleted, categoryBreakdown } = data.report;

        resultsDiv.innerHTML = `
          <strong>Report Date:</strong> ${reportDate}<br/>
          <strong>Total Requests Created:</strong> ${totalRequestsCreated}<br/>
          <strong>Total Requests Completed:</strong> ${totalRequestsCompleted}<br/>
        `;

        resultsDiv.innerHTML += categoryBreakdown.map(cat => `
          <div class="category">
            <strong>Category:</strong> ${cat.category}<br/>
            <strong>Created:</strong> ${cat.requestsCreated}<br/>
            <strong>Completed:</strong> ${cat.requestsCompleted}
          </div>
        `).join('');
      } catch (error) {
        resultsDiv.innerHTML = `<p>Error: ${error.message}</p>`;
      }
    });
  </script>
</body>
</html>
</body>
</html>
